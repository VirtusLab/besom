output-dir := justfile_directory() / ".out"
lambdas-output-dir := output-dir / "lambdas"

make-output-dir:
  mkdir -p {{output-dir}}

build-lambdas:
  rm -rf {{lambdas-output-dir}}
  mkdir -p {{lambdas-output-dir}}
  scala-cli compile lambdas/lambda1
  scala-cli compile lambdas/lambda2
  scala-cli package -f lambdas/lambda1 --assembly --preamble=false -o {{lambdas-output-dir}}/lambda1.jar
  scala-cli package -f lambdas/lambda2 --assembly --preamble=false -o {{lambdas-output-dir}}/lambda2.jar

build-lambda1:
  scala-cli package -f lambdas/lambda1 --assembly --preamble=false -o {{lambdas-output-dir}}/lambda1.jar

build-lambda2:
  scala-cli package -f lambdas/lambda2 --assembly --preamble=false -o {{lambdas-output-dir}}/lambda2.jar

infra-up:
  #!/usr/bin/env sh
  cd infra
  PULUMI_CONFIG_PASSPHRASE="" pulumi up --stack dev

infra-down:
  #!/usr/bin/env sh
  cd infra
  PULUMI_CONFIG_PASSPHRASE="" pulumi down --stack dev

infra-output:
  #!/usr/bin/env sh
  cd infra
  PULUMI_CONFIG_PASSPHRASE="" pulumi stack output --stack dev
